import React, { useState } from "react";
import styles from "./index.module.css";
import UserAvatar from "@/components/UserAvatar";
import TableUtils from "@/components/table/utils";
import TableIcon from "@/components/table/utils/icon";
import GlobalUtils from "@/lib/utils";
import endPointsICONS from "../../utils/icons";
import Table from "@/components/table";
import Modal from "@/components/Popup/Popup";
import VirtualMachine from "@/modules/VirtualMachines";
import GlobalICONS from "@/lib/utils/icons";

const EndPointsTable = () => {
    const [show, setShow] = useState({});
    const [userDetails, setUserDetails] = useState(null);

    const closeModel = () => setShow({ add: false, edit: false, delete: false });
    const initializeTableData = {
        totalPages: 16,
        totalDocuments: 156,
        data: [
            {
                _id: "6486cae1284e1728606f902c",
                "Product Name": "Dell Latitude 5420",
                "Serial Number": "ABC123456789",
                "Service Tag": "XYZ987654321",
                OEM: "Dell",
                Model: "Latitude 5420",
                Processor: "Intel Core i7-1185G7",
                "Disk Space (GB)": 512,
                "RAM (GB)": 16,
                "CPU Core Count": 4,
                CPE: "cpe:2.3:h:dell:latitude_5420:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2022-03-15",
                "Acquisition Date": "2022-03-20",
                "Warranty Expiry": "2025-03-15",
                "End of Support": "2027-03-15",
                "End of Life": "2030-03-15",
                "Procurement Period": "Q1 2022",
                "IP Address": "192.168.1.100",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1A:2B:3C:4D:5E",
                "NIC Count": 2,
                "Assigned Date": "2022-03-25",
                "Asset ID": "ASSET12345",
                "Asset Location": "New York Office",
                "Operating System (with version)": "Windows 10 Pro 21H2",
                "AD User Name": "john.doe",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "John Doe",
                "Custodian Email": "john.doe@example.com",
                "Custodian Department": "IT",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Dell Technologies",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO123456",
                "Bill Order Date": "2022-03-10",
                "Store Item Number": "SI789012",
                "Capital Expenditure (CapEx)": 1200,
                "Operational Expenditure (OpEx)": 50,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-09-01",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f902d",
                "Product Name": "HP EliteBook 840 G8",
                "Serial Number": "DEF987654321",
                "Service Tag": "LMN123456789",
                OEM: "HP",
                Model: "EliteBook 840 G8",
                Processor: "Intel Core i5-1135G7",
                "Disk Space (GB)": 256,
                "RAM (GB)": 8,
                "CPU Core Count": 4,
                CPE: "cpe:2.3:h:hp:elitebook_840_g8:-:*:*:*:*:*:*:*",
                "Device Status": "In Storage",
                "Procurement Date": "2021-11-10",
                "Acquisition Date": "2021-11-15",
                "Warranty Expiry": "2024-11-10",
                "End of Support": "2026-11-10",
                "End of Life": "2029-11-10",
                "Procurement Period": "Q4 2021",
                "IP Address": "192.168.1.101",
                "IP Allocation Type": "DHCP",
                "MAC Address": "00:1B:2C:3D:4E:5F",
                "NIC Count": 1,
                "Assigned Date": "2021-11-20",
                "Asset ID": "ASSET67890",
                "Asset Location": "San Francisco Office",
                "Operating System (with version)": "Windows 11 Pro 22H2",
                "AD User Name": "jane.smith",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Jane Smith",
                "Custodian Email": "jane.smith@example.com",
                "Custodian Department": "Finance",
                "Business Impact": "Medium",
                "Antivirus Status": "Enabled",
                Vendor: "HP Inc.",
                "Device Source": "Reseller",
                "Bill Order Number": "BO654321",
                "Bill Order Date": "2021-11-05",
                "Store Item Number": "SI098765",
                "Capital Expenditure (CapEx)": 1000,
                "Operational Expenditure (OpEx)": 40,
                "Device State": "Inactive",
                "Last Audit Date (If Any)": "2023-08-15",
                "Patch Level": "Pending",
            },
            {
                _id: "6486cae1284e1728606f902e",
                "Product Name": "Lenovo ThinkPad X1 Carbon",
                "Serial Number": "GHI123456789",
                "Service Tag": "OPQ987654321",
                OEM: "Lenovo",
                Model: "ThinkPad X1 Carbon Gen 9",
                Processor: "Intel Core i7-1165G7",
                "Disk Space (GB)": 1024,
                "RAM (GB)": 32,
                "CPU Core Count": 4,
                CPE: "cpe:2.3:h:lenovo:thinkpad_x1_carbon_gen9:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2023-01-10",
                "Acquisition Date": "2023-01-15",
                "Warranty Expiry": "2026-01-10",
                "End of Support": "2028-01-10",
                "End of Life": "2031-01-10",
                "Procurement Period": "Q1 2023",
                "IP Address": "192.168.1.102",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1C:2D:3E:4F:5A",
                "NIC Count": 2,
                "Assigned Date": "2023-01-20",
                "Asset ID": "ASSET54321",
                "Asset Location": "Chicago Office",
                "Operating System (with version)": "Windows 11 Pro 22H2",
                "AD User Name": "alice.johnson",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Alice Johnson",
                "Custodian Email": "alice.johnson@example.com",
                "Custodian Department": "HR",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Lenovo",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO987654",
                "Bill Order Date": "2023-01-05",
                "Store Item Number": "SI123456",
                "Capital Expenditure (CapEx)": 1500,
                "Operational Expenditure (OpEx)": 60,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-09-10",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f902f",
                "Product Name": "Apple MacBook Pro 16",
                "Serial Number": "JKL123456789",
                "Service Tag": "RST987654321",
                OEM: "Apple",
                Model: "MacBook Pro 16 (M1 Pro)",
                Processor: "Apple M1 Pro",
                "Disk Space (GB)": 512,
                "RAM (GB)": 16,
                "CPU Core Count": 10,
                CPE: "cpe:2.3:h:apple:macbook_pro_16_m1_pro:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2022-09-05",
                "Acquisition Date": "2022-09-10",
                "Warranty Expiry": "2025-09-05",
                "End of Support": "2027-09-05",
                "End of Life": "2030-09-05",
                "Procurement Period": "Q3 2022",
                "IP Address": "192.168.1.103",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1D:2E:3F:4A:5B",
                "NIC Count": 2,
                "Assigned Date": "2022-09-15",
                "Asset ID": "ASSET67891",
                "Asset Location": "Austin Office",
                "Operating System (with version)": "macOS Ventura 13.0",
                "AD User Name": "bob.wilson",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Bob Wilson",
                "Custodian Email": "bob.wilson@example.com",
                "Custodian Department": "Marketing",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Apple Inc.",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO456789",
                "Bill Order Date": "2022-09-01",
                "Store Item Number": "SI654321",
                "Capital Expenditure (CapEx)": 2500,
                "Operational Expenditure (OpEx)": 70,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-09-05",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f9030",
                "Product Name": "Microsoft Surface Laptop 4",
                "Serial Number": "MNO123456789",
                "Service Tag": "UVW987654321",
                OEM: "Microsoft",
                Model: "Surface Laptop 4",
                Processor: "AMD Ryzen 7 4980U",
                "Disk Space (GB)": 512,
                "RAM (GB)": 16,
                "CPU Core Count": 8,
                CPE: "cpe:2.3:h:microsoft:surface_laptop_4:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2022-07-20",
                "Acquisition Date": "2022-07-25",
                "Warranty Expiry": "2025-07-20",
                "End of Support": "2027-07-20",
                "End of Life": "2030-07-20",
                "Procurement Period": "Q3 2022",
                "IP Address": "192.168.1.104",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1E:2F:3A:4B:5C",
                "NIC Count": 2,
                "Assigned Date": "2022-07-30",
                "Asset ID": "ASSET54322",
                "Asset Location": "Seattle Office",
                "Operating System (with version)": "Windows 11 Pro 22H2",
                "AD User Name": "emily.brown",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Emily Brown",
                "Custodian Email": "emily.brown@example.com",
                "Custodian Department": "Sales",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Microsoft",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO321654",
                "Bill Order Date": "2022-07-15",
                "Store Item Number": "SI987654",
                "Capital Expenditure (CapEx)": 1800,
                "Operational Expenditure (OpEx)": 55,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-08-20",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f9031",
                "Product Name": "Asus ROG Zephyrus G14",
                "Serial Number": "PQR123456789",
                "Service Tag": "XYZ123456789",
                OEM: "Asus",
                Model: "ROG Zephyrus G14",
                Processor: "AMD Ryzen 9 5900HS",
                "Disk Space (GB)": 1000,
                "RAM (GB)": 32,
                "CPU Core Count": 8,
                CPE: "cpe:2.3:h:asus:rog_zephyrus_g14:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2021-12-01",
                "Acquisition Date": "2021-12-05",
                "Warranty Expiry": "2024-12-01",
                "End of Support": "2026-12-01",
                "End of Life": "2029-12-01",
                "Procurement Period": "Q4 2021",
                "IP Address": "192.168.1.105",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1F:2A:3B:4C:5D",
                "NIC Count": 2,
                "Assigned Date": "2021-12-10",
                "Asset ID": "ASSET67892",
                "Asset Location": "Boston Office",
                "Operating System (with version)": "Windows 10 Pro 21H2",
                "AD User Name": "michael.clark",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Michael Clark",
                "Custodian Email": "michael.clark@example.com",
                "Custodian Department": "Engineering",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Asus",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO789123",
                "Bill Order Date": "2021-11-25",
                "Store Item Number": "SI456789",
                "Capital Expenditure (CapEx)": 2000,
                "Operational Expenditure (OpEx)": 65,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-08-25",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f9032",
                "Product Name": "Acer Predator Helios 300",
                "Serial Number": "STU123456789",
                "Service Tag": "VWX987654321",
                OEM: "Acer",
                Model: "Predator Helios 300",
                Processor: "Intel Core i7-11800H",
                "Disk Space (GB)": 512,
                "RAM (GB)": 16,
                "CPU Core Count": 8,
                CPE: "cpe:2.3:h:acer:predator_helios_300:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2022-05-10",
                "Acquisition Date": "2022-05-15",
                "Warranty Expiry": "2025-05-10",
                "End of Support": "2027-05-10",
                "End of Life": "2030-05-10",
                "Procurement Period": "Q2 2022",
                "IP Address": "192.168.1.106",
                "IP Allocation Type": "Static",
                "MAC Address": "00:2A:3B:4C:5D:6E",
                "NIC Count": 2,
                "Assigned Date": "2022-05-20",
                "Asset ID": "ASSET54323",
                "Asset Location": "Denver Office",
                "Operating System (with version)": "Windows 11 Pro 22H2",
                "AD User Name": "sarah.adams",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Sarah Adams",
                "Custodian Email": "sarah.adams@example.com",
                "Custodian Department": "Design",
                "Business Impact": "Medium",
                "Antivirus Status": "Enabled",
                Vendor: "Acer",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO654987",
                "Bill Order Date": "2022-05-05",
                "Store Item Number": "SI321654",
                "Capital Expenditure (CapEx)": 1700,
                "Operational Expenditure (OpEx)": 50,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-08-30",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f9033",
                "Product Name": "Lenovo ThinkPad T14",
                "Serial Number": "VWX123456789",
                "Service Tag": "YZA987654321",
                OEM: "Lenovo",
                Model: "ThinkPad T14 Gen 2",
                Processor: "Intel Core i5-1145G7",
                "Disk Space (GB)": 256,
                "RAM (GB)": 8,
                "CPU Core Count": 4,
                CPE: "cpe:2.3:h:lenovo:thinkpad_t",
                "Asset ID": "ASSET12345",
            },
            {
                _id: "6486cae1284e1728606f902e",
                "Product Name": "Lenovo ThinkPad T14",
                "Serial Number": "GHI456123789",
                "Service Tag": "PQR567890123",
                OEM: "Lenovo",
                Model: "ThinkPad T14",
                Processor: "Intel Core i7-1165G7",
                "Disk Space (GB)": 512,
                "RAM (GB)": 16,
                "CPU Core Count": 4,
                CPE: "cpe:2.3:h:lenovo:thinkpad_t14:-:*:*:*:*:*:*:*",
                "Device Status": "Assigned",
                "Procurement Date": "2022-07-20",
                "Acquisition Date": "2022-07-25",
                "Warranty Expiry": "2025-07-20",
                "End of Support": "2027-07-20",
                "End of Life": "2030-07-20",
                "Procurement Period": "Q3 2022",
                "IP Address": "192.168.1.102",
                "IP Allocation Type": "Static",
                "MAC Address": "00:1C:2D:3E:4F:5G",
                "NIC Count": 2,
                "Assigned Date": "2022-08-01",
                "Asset ID": "ASSET11223",
                "Asset Location": "Chicago Office",
                "Operating System (with version)": "Windows 11 Pro 23H1",
                "AD User Name": "mike.johnson",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Mike Johnson",
                "Custodian Email": "mike.johnson@example.com",
                "Custodian Department": "Engineering",
                "Business Impact": "High",
                "Antivirus Status": "Enabled",
                Vendor: "Lenovo",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO789456",
                "Bill Order Date": "2022-07-15",
                "Store Item Number": "SI567890",
                "Capital Expenditure (CapEx)": 1250,
                "Operational Expenditure (OpEx)": 60,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-10-05",
                "Patch Level": "Latest",
            },
            {
                _id: "6486cae1284e1728606f902f",
                "Product Name": "Apple MacBook Pro 16",
                "Serial Number": "JKL321654987",
                "Service Tag": "STU987654321",
                OEM: "Apple",
                Model: "MacBook Pro 16 (M1)",
                Processor: "Apple M1 Pro",
                "Disk Space (GB)": 1024,
                "RAM (GB)": 32,
                "CPU Core Count": 10,
                CPE: "cpe:2.3:h:apple:macbook_pro_16:-:*:*:*:*:*:*:*",
                "Device Status": "In Use",
                "Procurement Date": "2023-01-05",
                "Acquisition Date": "2023-01-10",
                "Warranty Expiry": "2026-01-05",
                "End of Support": "2028-01-05",
                "End of Life": "2031-01-05",
                "Procurement Period": "Q1 2023",
                "IP Address": "192.168.1.103",
                "IP Allocation Type": "DHCP",
                "MAC Address": "00:2A:3B:4C:5D:6E",
                "NIC Count": 1,
                "Assigned Date": "2023-01-15",
                "Asset ID": "ASSET99887",
                "Asset Location": "Los Angeles Office",
                "Operating System (with version)": "macOS Ventura 14.0",
                "AD User Name": "sarah.williams",
                "Responsible (Managed By)": "IT Department",
                "Custodian Name": "Sarah Williams",
                "Custodian Email": "sarah.williams@example.com",
                "Custodian Department": "Design",
                "Business Impact": "Critical",
                "Antivirus Status": "Enabled",
                Vendor: "Apple Inc.",
                "Device Source": "Direct Purchase",
                "Bill Order Number": "BO987654",
                "Bill Order Date": "2022-12-30",
                "Store Item Number": "SI654321",
                "Capital Expenditure (CapEx)": 2800,
                "Operational Expenditure (OpEx)": 80,
                "Device State": "Active",
                "Last Audit Date (If Any)": "2023-11-01",
                "Patch Level": "Latest",
            },
        ],
    };
    const externalFilters = {
        title: "Desktop List",
        // filterOnSubmit: true,
        filterFields: [
            {
                type: "select",
                name: "role",
                grid: 3,
                options: [
                    { label: "Admin", value: "admin" },
                    { label: "Author", value: "author" },
                    { label: "Editor", value: "editor" },
                    { label: "Maintainer", value: "Maintainer" },
                    { label: "Subscriber", value: "subscriber" },
                ],
                placeholder: "Select Role",
            },
            {
                type: "select",
                name: "plan",
                grid: 3,
                options: [
                    { label: "Basic", value: "basic" },
                    { label: "Company", value: "company" },
                    { label: "Enterprise", value: "enterprise" },
                    { label: "Maintainer", value: "Maintainer" },
                    { label: "Subscriber", value: "subscriber" },
                ],
                placeholder: "Select Plan",
            },
            {
                type: "select",
                name: "status",
                grid: 3,
                options: [
                    { label: "Pending", value: "pending" },
                    { label: "Inactive", value: "inactive" },
                    { label: "Active", value: "active" },
                ],
                placeholder: "Select Status",
            },
        ],
        parentPayloadKey: `[search][filters]`,
    };

    const tableHeader = {
        limit: {
            defaultValue: "20",
            limitStart: "10",
            limitEnd: "50",
            multipleOf: "10",
        },
        actionButtons: [
            {
                variant: "primary",
                icon: TableIcon.PLUS,
                label: "Add New Desktop",
                onClick: () => {
                    setShow({ add: true });
                    console.log("user clicked add user button");
                },
            },
            {
                variant: "secondary",
                flat: true,
                className: styles.export,
                icon: TableIcon.EXPORT,
                label: "Export",
                onClick: () => console.log("user clicked export button"),
            },
        ],
        filters: [
            {
                type: "text",
                name: "searchText",
                grid: 2,
                placeholder: "Search desktop",
                autoSuggestion: {
                    initialData: TableUtils.formatDataForAutoSuggestion(initializeTableData.data, ["Product Name", "Serial Number", "Service Tag"]),
                    autoSuggestionUrl: "/api/suggestions",
                    minChars: 1,
                    maxSuggestions: 5,
                },
                className: styles.search_field,
            },
        ],
    };

    function getTableData(data) {
        return {
            title: "Active Employees List",
            rows: data?.data?.map((item) => {
                const data = {
                    Id: { key: "_id", value: item._id, type: "hidden" },
                    "Asset ID": { key: "Asset ID", value: item["Asset ID"] },
                    "Product Name": { key: "Product Name", value: item["Product Name"] },
                    Model: { key: "Model", value: item.Model },
                    "Serial Number": { key: "Serial Number", value: item["Serial Number"] },
                    Processor: { key: "Processor", value: item["Processor"] },
                    "RAM (GB)": { key: "RAM (GB)", value: item["RAM (GB)"] },
                    // "Disk Space (GB)": { key: "Disk Space (GB)", value: item["Disk Space (GB)"] },
                    "Device Status": { key: "Device Status", value: item["Device Status"] },
                };

                return data;
            }),
            actionData: [
                {
                    name: "Delete",
                    functions: (row) => {
                        console.log(row);
                    },
                    label: "Delete User",
                    Id: "Id",
                },
                {
                    name: "View",
                    functions: (row) => {
                        console.log("hg", row["Id"].value);
                    },
                    label: "View  Details",
                    Id: "Id",
                },
                {
                    name: "Edit",
                    functions: (row) => {
                        setUserDetails(data?.data?.find((item) => row["Id"].value === item._id));
                        setShow({ edit: true, add: false, remove: false });
                        // console.log("hg", row["Id"].value);
                    },
                    label: "Edit Details",
                    Id: "Id",
                },
                {
                    name: "Duplicate",
                    functions: (row) => {
                        setUserDetails(data?.data?.find((item) => row["Id"].value === item._id));
                        setShow({ edit: true, add: false, remove: false });
                        // console.log("hg", row["Id"].value);
                    },
                    label: "Duplicate User",
                    Id: "Id",
                },
            ],
            url: `/getlistofuserdata`,
            pagination: {
                totalPage: data.totalPages || "0",
                totalItemCount: data.totalDocuments || "0",
            },
            sorting: {
                initialSort: "User",
                initialSortOrder: "asc",
            },
            getTableData: getTableData,
            rowClickHandler: (row) => {
                console.log(row);
            },
            externalFilters,
            tableHeader,
            checkbox: true,
        };
    }

    const tableData = React.useMemo(() => getTableData(initializeTableData), []);

    return (
        <div className={styles.container}>
            {<Table tableData={tableData} />}

            <Modal show={show.add} onClose={closeModel} title={"Add Desktop"} maxWidth={"1600px"} icon={GlobalICONS.DESKTOP} description="Add Virtual Machine Configuration">
                <VirtualMachine />
            </Modal>
            <Modal show={show.edit} onClose={closeModel} title={"Edit User"} maxWidth={"800px"}>
                <VirtualMachine />
            </Modal>
        </div>
    );
};

export default EndPointsTable;
